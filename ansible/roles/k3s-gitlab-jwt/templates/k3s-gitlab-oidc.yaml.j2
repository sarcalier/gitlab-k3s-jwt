# K3s OIDC configuration for GitLab CI_JOB_JWT
# Managed by Ansible - appended to existing k3s config

# GitLab OIDC Authentication for Kubernetes API server
kube-apiserver-arg:
  - "oidc-issuer-url={{ k3s_gitlab_url }}"
  - "oidc-client-id={{ k3s_gitlab_client_id }}"
  - "oidc-username-claim={{ k3s_gitlab_username_claim }}"
  - "oidc-groups-claim={{ k3s_gitlab_groups_claim }}"
  - "oidc-username-prefix=gitlab:"
  - "oidc-groups-prefix=gitlab:"
  # Allow OIDC without groups claim (groups_direct may be empty)
  - "oidc-required-claim=iss:{{ k3s_gitlab_url }}"
